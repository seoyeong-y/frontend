# 🛠️ 트러블 슈팅 보고서 (Chatbot UI 개선)

> **프로젝트명:** TUK NAVI - AI 기반 맞춤형 커리큘럼 및 시간표 생성 서비스
> **기술스택:** React, TypeScript, MUI, Framer-motion
> **작성자:** 박진한
> **날짜:** 2025-07-05

---

## 📌 문제 상황

### 문제 증상

* 챗봇 UI를 구현하는 과정에서, 사용자와 AI의 채팅 메시지가 **좌측과 우측 끝으로 각각 정렬되지 않고, AI 메시지가 화면 중앙에 위치**하는 현상이 발생했습니다.
* 특히 AI 메시지에서 커리큘럼 추천 등의 카드를 포함한 경우, 전체 화면 너비를 차지하며 예상하지 못한 UI 깨짐 현상을 초래했습니다.

### 기대했던 동작

* 사용자의 메시지는 항상 우측 끝에 배치되며, AI 메시지는 항상 좌측 끝에 배치되는 일반적인 메신저 스타일(카카오톡과 같은)을 원했습니다.
* AI의 메시지가 카드 형태(GlassCard 등)를 포함하더라도 좌측 끝에서 일정 폭 이상 넘어가지 않도록 제한되기를 기대했습니다.

---

## 🔍 원인 분석

채팅 UI의 구성은 다음과 같이 이루어져 있었습니다:

* `MessageBubble` 컴포넌트가 메시지 정렬을 담당하고 있었으나, 내부에 있는 자식 컴포넌트(Box)에서 `width: '100%'`, `maxWidth: '100%'` 등의 스타일 속성이 지정되어 있어, 정렬을 무효화하는 문제가 있었습니다.
* 복합적인 카드 형태의 메시지를 전달하는 경우, 부모 컴포넌트의 너비 제약이 없어 전체 화면 너비로 확장되어 버리는 문제가 발견되었습니다.

구체적으로는 다음 코드 부분에서 문제를 확인했습니다:

```tsx
// 문제가 발생한 코드 (Chatbot.tsx)
<Box sx={{
  width: '100%',
  maxWidth: '100%',
  margin: 0,
  alignSelf: 'flex-start', // 좌측 정렬 의도했으나 작동 안됨
  p: 0,
}}>
```

이 코드가 내부 콘텐츠(Box 컴포넌트)를 전체 너비로 확장시켜 정렬이 의도대로 이루어지지 않은 원인이었습니다.

---

## 🚧 시도했던 해결 방안 및 고민 사항

### 1️⃣ 스타일 속성 조정 시도

* `width: '100%'`와 `maxWidth` 속성을 제거하거나 축소하여 AI 메시지를 좌측 끝으로 고정하려 했습니다.
* 그러나 카드 형태 콘텐츠의 폭이 일정하지 않아 여러 시각적 불균형 현상이 생겨 어려움을 겪었습니다.

### 2️⃣ 컨테이너와 콘텐츠 역할 분리

* 컨테이너(부모 Box)가 정렬 책임을 전담하도록 하고 내부 콘텐츠는 단순히 콘텐츠 크기만큼만 늘어나게 하려고 했습니다.
* 콘텐츠의 크기나 내용에 따라 최대 너비를 일관되게 유지하는 방안을 찾는 데 고민을 많이 했습니다.

### 3️⃣ 정렬 Flexbox 재구성

* Flexbox의 `justifyContent` 속성을 명확하게 설정하여 사용자 메시지는 `flex-end`, AI 메시지는 `flex-start`로 강제로 지정하는 방안을 선택했습니다.
* 콘텐츠 너비를 강제로 제한(`maxWidth`)하여 컨테이너가 원하는 방향으로 정렬되도록 하였습니다.

---

## ✅ 최종 해결 방법

최종적으로 아래와 같이 코드를 수정하여 문제를 완벽하게 해결하였습니다:

```tsx
// components/common/Message.tsx 수정 내용
<Box
  sx={{
    display: 'flex',
    justifyContent: from === 'user' ? 'flex-end' : 'flex-start',
    width: '100%',
    my: 1,
  }}
>
  <Box
    sx={{
      maxWidth: from === 'user' ? '70%' : 520, // AI 메시지는 최대 너비를 520px로 제한
      background: from === 'user' ? gradientBlue : '#fff',
      borderRadius: 3,
      boxShadow: '0 2px 12px rgba(60,60,130,.08)',
      p: from === 'user' ? 1.5 : 2,
    }}
  >
    {children}
  </Box>
</Box>
```

* 사용자 메시지는 최대 폭의 70%로, AI 메시지는 명확한 최대 픽셀값(520px)으로 제한해 화면 전체 너비를 침범하지 못하도록 조정했습니다.
* Flexbox의 정렬 속성을 명확히 분리하여 AI와 사용자 메시지를 좌우로 명확히 구분했습니다.

---

## 🎯 최종 결과

* 사용자 메시지: 우측 끝에서 적절히 배치
* AI 메시지: 좌측 끝에 고정되며, 카드와 같은 복합 콘텐츠도 화면 중앙이 아닌 좌측에서 일관되게 표시됨
* 다양한 화면 사이즈(데스크톱 및 모바일)에서도 메시지 정렬이 깔끔하게 유지됨

---

## 🧹 향후 관리 및 추가 고려사항

* UI 가이드라인을 명확히 정의해 메시지 컴포넌트의 `maxWidth` 속성을 일관되게 관리할 예정입니다.
* Storybook이나 UI 테스트 도구를 사용하여 향후 정렬 관련 문제가 발생하지 않도록 지속적으로 관리할 예정입니다.
* CSS 또는 스타일링 코딩 표준을 마련하여 무분별한 너비 설정(`width: 100%`) 사용을 방지할 예정입니다.

---

## 🔖 커밋 메시지

```
fix(chat-ui): 메시지 좌우 정렬 개선 및 너비 제한 추가

- 사용자 메시지는 오른쪽 정렬, AI 메시지는 왼쪽 정렬을 명확히 함
- AI 메시지 최대 너비 520px로 제한하여 UI 깨짐 방지

Closes #12 (Chatbot 메시지 정렬 이슈)
```

--- 